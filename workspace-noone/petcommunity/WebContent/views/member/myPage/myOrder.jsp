<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8" import="com.kh.member.model.vo.MyOrder, com.kh.member.model.vo.PageInfo,java.util.ArrayList"%>
<%
	//Ï£ºÎ¨∏ÎÇ¥Ïó≠ ArrayList ÌïÑÏöî
	//userNo Í∏∞Ï§ÄÏúºÎ°ú MyOrder Í∞ùÏ≤¥Ïóê Îã¥ÏùÄ Ï£ºÎ¨∏Ï†ïÎ≥¥Î•º Î¶¨Ïä§Ìä∏ÌôîÏãúÏºúÏÑú Î≥¥Ïó¨Ï£ºÏûê.
	
	//Ï£ºÎ¨∏ÎÇ¥Ïó≠ÏùÄ Ï£ºÎ¨∏ÏÉÅÌÉúÏóêÎî∞Îùº Îã§Î•¥Í≤å ÌëúÏãúÌï¥ÏïºÌïúÎã§.
	// ÏÉÅÌÉú : (ÏÉÅÌíà)Î∞∞ÏÜ°Ï§ÄÎπÑÏ§ë(B), Î∞∞ÏÜ°Ï§ë(D), Î∞∞ÏÜ°ÏôÑÎ£å(C), ÍµêÌôò/ÌôòÎ∂à ÏßÑÌñâÏ§ë 
	// Ï£ºÎ¨∏ ÏÉÅÌÉúÏóê Îî∞Îùº Î≤ÑÌäºÎèÑ Îã¨ÎùºÏ†∏ÏïºÌïòÍ≥† ÌëúÍ∏∞ÎêòÎäî ÎÇ¥Ïö©Ïù¥ Ï°∞Í∏àÏî© Î∞îÎÄåÏñ¥ÏïºÌïúÎã§.
	
	//ÎΩëÏïÑÏôÄÏïºÌïòÎäî Îç∞Ïù¥ÌÑ∞Îì§?
	//ÏÉÅÌíàÏÇ¨ÏßÑ, ÏÉÅÌíàÎ™Ö, ÏÉÅÌíàÏù¥Î¶Ñ, ÏÉÅÌíàÍ∞ÄÍ≤©, Ï£ºÎ¨∏ÎÇ†Ïßú, Ï£ºÎ¨∏ÏÉÅÌÉú, Î∞∞ÏÜ°ÏÉÅÌÉú
	
	ArrayList<MyOrder> list = (ArrayList<MyOrder>)request.getAttribute("orderList");
	PageInfo pi = (PageInfo)request.getAttribute("pi");
	String myOrderSort = (String)request.getAttribute("sortOption"); //Ï†ïÎ†¨Í∏∞Îä•Ïóê Ïì∞Ïùº Î≥ÄÏàò
	System.out.println(myOrderSort);
%>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
<style>
/*myOrder.css*/
.wrapper {
  height: 200vh !important;
}

.myOrderWrap {
  height: 100%;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
}

.myOrderWrap > h1 {
  font-size: 60px;
  margin-top: 100px;
}

.myOrderWrap > h2 {
  margin-top: 70px;
  margin-bottom: 30px;
  font-size: 40px;
}

.myOrderWrap .emptyList {
  border: 2px solid black;
  display: flex;
  flex-direction: column;
  justify-content: center;
  width: 70%;
  height: 300px;
  align-self: center;
}

.myOrderWrap #emptySign {
  font-size: 100px;
  text-align: center;
}

.myOrderWrap #emptyMessage {
  font-size: 30px;
}

.myOrderWrap #emptySign,
.myOrderWrap #emptyMessage {
  align-self: center;
}

.myOrderWrap form {
  display: flex;
  flex-direction: column;
}

.myOrderWrap .orderList {
  display: flex;
  flex-direction: column;
  justify-content:flex-start;
  align-self: center;
  width: 70%;
  height: 50%;
}

.myOrderWrap #sortSelect {
  align-self: flex-end;
  margin-right:205px;
  width: 70px;
  height: 30px;
  font-size: 20px;
  margin-bottom: 20px;
}

.myOrderWrap #orderSortForm {
  height: 30px;
}

.myOrderWrap .order {
  align-self: center;
  border-top: 2px solid gray;
  border-bottom: 2px solid gray;
  width: 95%;
  height: 150px;
  margin:5px;
  display: flex;
}

.myOrderWrap .thumbnail {
  align-self: center;
  height: 130px;
  width: 200px;
  border: 1px solid gray;
}

.myOrderWrap .orderInfo {
  display: flex;
  justify-content: space-between;
  font-size: 20px;
  width: 60%;
  margin-left: 10px;
}

.myOrderWrap .orderInfo > table {
  align-self: center;
  width: 50%;
}

.myOrderWrap .order td {
  text-align: left;
}

.myOrderWrap .orderInfo tr:nth-child(3) > td {
  color: red;
}

.myOrderWrap .shipInfo {
  align-self: center;
  font-size: 20px;
  width: 40%;
  /* display: none; */
}

.myOrderWrap .orderBtn {
  width: 20%;
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.myOrderWrap .orderBtn > button {
  font-size: 20px;
  border: none;
  margin: 5px;
}

.myOrderWrap .pageNum {
  margin-top: 30px;
  display: flex;
  justify-content: center;
  width: 50%;
  align-self: center;
}

.order img{
	width:100%;
	height:100%;
}
/*ÌòÑÏû¨ Î≥¥Í≥†ÏûàÎäî Î©îÎâ¥ ÏÉâÏÉÅ ÌëúÏãú!*/
.sideBar .subMenu:nth-child(2) *{color:tomato;}
</style>
</head>
<body>

    <div class="wrapper">

      <%@include file="/views/common/menubar.jsp" %>

      <div class="main">

        
				        <%@include file="/views/member/myPage/sideBar.jsp" %>
				      
				      
				      
				        <div class="content">
				
							
					          <!-- Ï£ºÎ¨∏ÎÇ¥Ïó≠ ÏóÜÏùÑ Í≤ΩÏö∞-->
					         <%if(list.size()==0){ %>
					         <div class="myOrderWrap">
					            <h1>Ï£ºÎ¨∏ÎÇ¥Ïó≠Ï°∞Ìöå</h1>
					            <h2>Ï£ºÎ¨∏/Î∞∞ÏÜ° ÎÇ¥Ïó≠</h2>
					            <div class="emptyList">
					              <div id="emptySign">üòÅ</div>
					              <div id="emptyMessage">Ï£ºÎ¨∏ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§.</div>
					            </div>
					          </div>--><!-- myOrderWrap -->
					          <%} else{%>
					          
					          <!-- Ï£ºÎ¨∏ÎÇ¥Ïó≠ ÏûàÏùÑ Í≤ΩÏö∞ -->
					          <div class='myOrderWrap'>
					            
						            <h1>Ï£ºÎ¨∏ÎÇ¥Ïó≠Ï°∞Ìöå</h1>
						            <h2>Ï£ºÎ¨∏/Î∞∞ÏÜ° ÎÇ¥Ïó≠</h2>
						            

					              <select name="sortOption" id="sortSelect" onchange="setMyOrderSort();">
					              	<%if(myOrderSort.equals("newest")){ %>
						                <option value="newest" selected>ÏµúÏã†Ïàú</option>
						                <option value="oldest">Í≥ºÍ±∞Ïàú</option>
					                <%}else{ %>
						                <option value="newest">ÏµúÏã†Ïàú</option>
						                <option value="oldest" selected>Í≥ºÍ±∞Ïàú</option>
					                <%} %>
					              </select>

						            
						              <div class="orderList">
						                
				             	<%for(MyOrder o : list){ %>
				             	
						                <!-- ÏÉÅÌíàÏ§ÄÎπÑÏ§ë -->
					                <%if(o.getdStatus().equals("B")){ // ÏÉÅÌíàÏ§ÄÎπÑÏ§ëÏù∏Í≤ΩÏö∞ %>
						                <div class="order">
			                                <div class="thumbnail">
			                                  	<img src="<%=contextPath%>/<%=o.getpThumbUrl() %>">
			                                </div>
			                                <div class="orderInfo">
			                                  <table>
			                                    <tr>
			                                      <td colspan="2"><%=o.getpName() %></td>
			                                    </tr>
			                                    <tr>
			                                      <td><%=o.getOrderNo() %></td>
			                                      <td><%=o.getPrice() %>Ïõê</td>
			                                      <td><%=o.getOrderDate() %></td>
			                                    </tr>
			                                    <tr>
			                                    <%if(o.getShoppingStatus().equals("R")){//Ï£ºÎ¨∏Ï∑®ÏÜåÏù∏Í≤ΩÏö∞ %>
			                                      <td colspan="2">Ï£ºÎ¨∏Ï∑®ÏÜåÎê®</td>
				                                <%}else{ %>
			                                      <td colspan="2" class="myOrderState">ÏÉÅÌíàÏ§ÄÎπÑÏ§ë</td>
				                                <%} %>	
			                                    </tr>
			                                  </table>
			                                </div>
			                                <div class="orderBtn">
			                                  <%if(o.getShoppingStatus().equals("R")){//Ï£ºÎ¨∏Ï∑®ÏÜåÏù∏Í≤ΩÏö∞ %>
			                                  <button type="button" disabled>Ï£ºÎ¨∏Ï∑®ÏÜå</button>
			                                  <%}else{ %>
			                                  <button type="button" onclick="cancelOrder(<%=o.getOrderNo()%>);" class="myOrderCancelBtn">Ï£ºÎ¨∏Ï∑®ÏÜå</button>
			                                  <%} %>
			                                </div>
			                              </div>
		                              <%}%>
		                              <%if(o.getdStatus().equals("D")){ //Î∞∞ÏÜ°Ï§ëÏù∏Í≤ΩÏö∞ %>
			                              <!-- Î∞∞ÏÜ°Ï§ë -->
			                              <div class="order">
			                                <div class="thumbnail">
			                                 	 <img src="<%=contextPath%>/<%=o.getpThumbUrl() %>">
			                                </div>
			                                <div class="orderInfo">
			                                  <table>
			                                    <tr>
			                                      <td colspan="2"><%=o.getpName() %></td>
			                                    </tr>
			                                    <tr>
                             			          <td><%=o.getOrderNo() %></td>
			                                      <td><%=o.getPrice() %>Ïõê</td>
			                                      <td><%=o.getOrderDate() %></td>
			                                    </tr>
			                                    <tr>
			                                      <td colspan="2">Î∞∞ÏÜ°Ï§ë</td>
			                                    </tr>
			                                  </table>
			                                  <div class="shipInfo">
			                                    <table>
			                                      <tr>
			                                        <td>ÌÉùÎ∞∞ÏÇ¨ : <%=o.getdCompany() %></td>
			                                      </tr>
			                                      <tr>
			                                        <td>Ïö¥ÏÜ°Ïû•Î≤àÌò∏ : <%=o.getdNum() %></td>
			                                      </tr>
			                                    </table>
			                                  </div>
			                                </div>
			                                <div class="orderBtn">
			                                  <button type="button">Î∞∞ÏÜ°Ï°∞Ìöå</button>
			                                </div>
			                              </div>
			                              <%} %>
			                              <%if(o.getdStatus().equals("C")){ //Î∞∞ÏÜ°ÏôÑÎ£åÏù∏Í≤ΩÏö∞ %>
			                              <!-- Î∞∞ÏÜ°ÏôÑÎ£å -->
			                              <div class="order">
			                                <div class="thumbnail">
			                                  	<img src="<%=contextPath%>/<%=o.getpThumbUrl() %>">
			                                </div>
			                                <div class="orderInfo">
			                                  <table>
			                                    <tr>
			                                      <td colspan="2"><%=o.getpName() %></td>
			                                    </tr>
			                                    <tr>
			                                      <td><%=o.getOrderNo() %></td>
			                                      <td><%=o.getPrice() %>Ïõê</td>
			                                      <td><%=o.getOrderDate() %></td>
			                                    </tr>
			                                    <tr>
			                                      <td colspan="2">Î∞∞ÏÜ°ÏôÑÎ£å</td>
			                                    </tr>
			                                  </table>
			                                </div>
			                                <div class="orderBtn">
			                                  <button type="button" onclick="location.href=<%=contextPath%>/review.st?pno=<%=o.getpNo()%>">Î¶¨Î∑∞ÏûëÏÑ±</button>
			                                  <button type="button">ÍµêÌôò/ÌôòÎ∂à</button>
			                                </div>
			                              </div><!--order-->
			                              <%} %>

			                              
	                              <%} %><!--listÏóê ÎåÄÌïú forÎ¨∏ ÎÅù -->
			                              
			                             
						                
						              </div><!--orderList-->
						              
						              <div class="pageNum">
						                <ul class="pagination">
						                	<!-- javascript myOrderSubmit Ìï®ÏàòÎäî sideBar.jsp ÎÇ¥Î∂ÄÏóê Í∏∞Ïà†ÎêòÏñ¥ÏûàÏùå-->
							                <% if(pi.getCurrentPage() != 1){ %>
						            		  <li class="page-item"><a class="page-link" href="javascript:" onclick="myOrderSubmit(<%=loginUser.getUserNo()%>,<%=pi.getCurrentPage()-1%>,'<%=myOrderSort%>','.pageNum');">Previous</a></li>
											<% } %>
											<% for(int p=pi.getStartPage(); p<=pi.getEndPage(); p++){ %>
						            		  <li class="page-item" id="pNum"><a class="page-link" href="javascript:" onclick="myOrderSubmit(<%=loginUser.getUserNo()%>,<%=p%>,'<%=myOrderSort%>','.pageNum');"><%=p%></a></li>
								            <% } %>
											<% if(pi.getCurrentPage() != pi.getMaxPage()){ %>
						            		  <li class="page-item"><a class="page-link" href="javascript:" onclick="myOrderSubmit(<%=loginUser.getUserNo()%>,<%=pi.getCurrentPage()+1%>,'<%=myOrderSort%>','.pageNum');">Next</a></li>
											<% } %>
						                </ul>
						              </div>
				              		<%} %><!-- Ï£ºÎ¨∏ÎÇ¥Ïó≠ ÏûàÏùÑ Í≤ΩÏö∞(else)Ïùò ÎÅù. -->
				              </div><!-- myOrderWrap -->
				    			
			        	</div><!-- content -->
				

      </div><!-- main -->

      <div class="footer">
		<%@include file="/views/common/footer.jsp" %>
      </div>

    </div>
    
<script>

	//ÌòÑÏû¨ Î≥¥Í≥†ÏûàÎäî ÌéòÏù¥ÏßÄ Ïà´Ïûê Ïπ†Ìï¥Ï£ºÎäî ÏûêÎ∞îÏä§ÌÅ¨Î¶ΩÌä∏
	let item = document.querySelectorAll("#pNum"); //Ïà´ÏûêÎ•º Í∞ÄÏßÑ ÌéòÏù¥ÏßïÎ∞îÏùò Î™®Îì† ÏöîÏÜå Í∞ÄÏ†∏Ïò®Îã§.
	
	item.forEach(function(element){ //Í∞ÅÍ∞ÅÏùò ÏöîÏÜåÎì§Ïóê ÎåÄÌï¥
		if(element.innerText==<%=pi.getCurrentPage()%>){//ÌòÑÏû¨ÌéòÏù¥ÏßÄÏôÄ Í∞ôÏùÄ Ïà´ÏûêÎ•º Í∞ÄÏßÄÍ≥†ÏûàÏúºÎ©¥
			element.setAttribute('class','page-item active'); //Î™®Îã¨ classÏù∏ activeÎ•º Ï∂îÍ∞ÄÌï¥Ï£ºÏûê.
		}
	})
	
	
	
	//Ï£ºÎ¨∏Ï∑®ÏÜå Î©îÏÜåÎìú
	function cancelOrder(orderNo){ //Îß§Í∞úÎ≥ÄÏàòÎ°ú Ï£ºÎ¨∏Î≤àÌò∏ Î∞õÏïÑÏò®Îã§
		
		if(confirm('Ï†ïÎßê Ï£ºÎ¨∏Ï∑®ÏÜåÌïòÏãúÍ≤†ÏäµÎãàÍπå?')){ //confirm ÌôïÏù∏ÌÅ¥Î¶≠ Ïãú Ïã§ÌñâÎê† ÎÇ¥Ïö©
			$(function(){
				console.log(orderNo);
				//Ï£ºÎ¨∏Ï∑®ÏÜåÎ≤ÑÌäº ÏÇ¨ÎùºÏßÄÍ≥† "Ï£ºÎ¨∏Ï∑®ÏÜåÎê® Î≥ÄÍ≤Ω", ÏÉÅÌíàÏ§ÄÎπÑÏ§ë->"Ï£ºÎ¨∏Ï∑®ÏÜå"Î°ú Î≥ÄÍ≤Ω
				//SHOPPING ÌÖåÏù¥Î∏îÏùò SHOPPING_STATUS = 'R'Î°ú Î∞îÍøîÏïºÌï®
				//Ïù¥ Í≥ºÏ†ïÏóêÏÑú Ï£ºÎ¨∏Î≤àÌò∏ ÎÑòÍ≤®Ï§òÏïº
				$.ajax({
					url:"<%=contextPath%>/cancelOrder.me",
					type:"post",
					data:{
							orderNo:orderNo
						},
					success:function(result){
						if(result==='success'){
							location.reload();
						}else{
							alert('Ï£ºÎ¨∏Ï∑®ÏÜåÏã§Ìå®');
						}
					},
					error:function(){
						console.log('ajaxÌÜµÏã† Ïã§Ìå®');
					}
				})
			});
		}
	}

		
	
	function setMyOrderSort(){
		$(function(){
			let sortOption = $('.myOrderWrap #sortSelect').val();
				console.log(sortOption);
			if(sortOption=='newest'){
				myOrderSubmit(<%=loginUser.getUserNo()%>,1,'newest','#menuContent .myOrderMenu');
			}else{
				console.log(sortOption);
				myOrderSubmit(<%=loginUser.getUserNo()%>,1,'oldest','#menuContent .myOrderMenu');
			}
		});
	};


</script>
</body>
</html>